<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>F1 Driver Style Comparison: Average Trajectories (Full Race)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #111;
            color: #eee;
            text-align: center;
        }

        #chart {
            background: #222;
            margin: 20px auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .controls {
            margin: 20px;
        }

        button {
            background: #e10600;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 5px;
        }

        button:hover {
            background: #ff1e1e;
        }

        button.active {
            background: #5ec962;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-line {
            width: 40px;
            height: 4px;
            border-radius: 2px;
        }

        .explanation {
            max-width: 800px;
            margin: 30px auto;
            text-align: left;
            background: #222;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #e10600;
            line-height: 1.6;
        }

        .explanation h2 {
            margin-top: 0;
            color: #fff;
            font-size: 18px;
        }

        .explanation p {
            color: #ccc;
            font-size: 14px;
        }

        .explanation strong {
            color: #fff;
        }

        /* Driver line styles */
        .driver-line {
            fill: none;
            stroke-width: 3;
            opacity: 0.3;
            transition: opacity 0.3s, stroke-width 0.3s;
        }

        .driver-line.active {
            stroke-width: 5;
            opacity: 1.0;
            filter: brightness(1.3) drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
        }

        .driver-marker {
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .driver-marker.active {
            opacity: 1.0;
        }
    </style>
</head>

<body>

    <h1>Driver Style Comparison (Average Trajectories - Full Race)</h1>
    <p>Comparing the average driving style of three drivers throughout the entire race.</p>

    <div class="controls">
        <button id="btn-all" class="active">Show All</button>
        <button id="btn-verstappen">Verstappen Only</button>
        <button id="btn-perez">Perez Only</button>
        <button id="btn-tsunoda">Tsunoda Only</button>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-line" style="background: #9D4EDD;"></div>
            <span>Max Verstappen (#1)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #0096C7;"></div>
            <span>Sergio Perez (#11)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #FFD60A;"></div>
            <span>Yuki Tsunoda (#22)</span>
        </div>
    </div>

    <div id="chart"></div>

    <div class="explanation">
        <h2>ğŸ“Š å¦‚ä½•è§£è®€æ­¤åœ–è¡¨ (How to Read)</h2>
        <p>æ­¤åœ–å±•ç¤ºäº†ä¸‰ä½è»Šæ‰‹åœ¨<strong>æ•´å ´æ¯”è³½</strong>çš„å¹³å‡é§•é§›é¢¨æ ¼ã€‚æ¯æ¢ç·šä»£è¡¨è©²è»Šæ‰‹æ‰€æœ‰åœˆæ¬¡çš„å¹³å‡æ“ä½œæ¨¡å¼ã€‚</p>
        <p>
            <strong>1. è»Œè·¡é‡ç–Š (Overlap)ï¼š</strong><br>
            è‹¥å…©æ¢ç·šç·Šå¯†é‡ç–Šï¼Œä»£è¡¨å…©ä½è»Šæ‰‹çš„å¹³å‡é§•é§›é¢¨æ ¼ç›¸ä¼¼ã€‚åˆ†æ­§è™•å‰‡é¡¯ç¤ºæ“ä½œå·®ç•°ã€‚
        </p>
        <p>
            <strong>2. äº’å‹•åŠŸèƒ½ (Interactive)ï¼š</strong><br>
            é»æ“Šä¸Šæ–¹æŒ‰éˆ•å¯ä»¥å–®ç¨æŸ¥çœ‹æŸä½è»Šæ‰‹çš„è»Œè·¡ï¼Œæˆ–é¡¯ç¤ºå…¨éƒ¨é€²è¡Œæ¯”è¼ƒã€‚<br>
            <strong>â—‹</strong> = èµ·é» (å…¥å½) | <strong>Ã—</strong> = çµ‚é» (å‡ºå½)
        </p>
        <p>
            <strong>3. é¢¨æ ¼å·®ç•° (Style Differences)ï¼š</strong><br>
            è§€å¯Ÿä¸‰æ¢ç·šçš„å½¢ç‹€å’Œä½ç½®å·®ç•°ï¼Œå¯ä»¥çœ‹å‡ºï¼š
        <ul>
            <li><strong>Verstappen vs Perez</strong>ï¼šåŒéšŠè»Šæ‰‹ï¼Œå·®ç•°åæ˜ å€‹äººé§•é§›ç¿’æ…£</li>
            <li><strong>Tsunoda</strong>ï¼šä¸åŒè»ŠéšŠ(AlphaTauri)ï¼Œå·®ç•°åŒ…å«è³½è»Šæ€§èƒ½å› ç´ </li>
        </ul>
        </p>
    </div>

    <script>
        const width = 800;
        const height = 600;
        const margin = { top: 20, right: 20, bottom: 20, left: 20 };

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Color mapping
        const colors = {
            1: '#9D4EDD',   // Verstappen - Purple
            11: '#0096C7',  // Perez - Blue
            22: '#FFD60A'   // Tsunoda - Yellow
        };

        const driverNames = {
            1: 'Verstappen',
            11: 'Perez',
            22: 'Tsunoda'
        };

        d3.csv("driver_average_styles.csv").then(data => {

            // Parse numbers
            data.forEach(d => {
                d.mds_x = +d.mds_x;
                d.mds_y = +d.mds_y;
                d.driver = +d.driver;
            });

            // Group by driver
            const drivers = d3.groups(data, d => d.driver);

            // Scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(data, d => d.mds_x))
                .range([0, width - margin.left - margin.right]);

            const yScale = d3.scaleLinear()
                .domain(d3.extent(data, d => d.mds_y))
                .range([height - margin.top - margin.bottom, 0]);

            // Line generator
            const line = d3.line()
                .x(d => xScale(d.mds_x))
                .y(d => yScale(d.mds_y))
                .curve(d3.curveCatmullRom.alpha(0.5));

            // Draw driver lines
            const paths = g.selectAll(".driver-line")
                .data(drivers)
                .enter().append("path")
                .attr("class", "driver-line active")
                .attr("d", d => line(d[1]))
                .attr("stroke", d => colors[d[0]])
                .attr("id", d => "driver-" + d[0]);

            // Draw markers
            const startMarkers = g.selectAll(".start-marker")
                .data(drivers)
                .enter().append("circle")
                .attr("class", d => "driver-marker active start-" + d[0])
                .attr("cx", d => xScale(d[1][0].mds_x))
                .attr("cy", d => yScale(d[1][0].mds_y))
                .attr("r", 6)
                .attr("fill", d => colors[d[0]])
                .attr("stroke", "white")
                .attr("stroke-width", 2);

            const endMarkers = g.selectAll(".end-marker")
                .data(drivers)
                .enter().append("path")
                .attr("class", d => "driver-marker active end-" + d[0])
                .attr("d", d3.symbol().type(d3.symbolCross).size(100))
                .attr("transform", d => `translate(${xScale(d[1][d[1].length - 1].mds_x)},${yScale(d[1][d[1].length - 1].mds_y)})`)
                .attr("fill", d => colors[d[0]])
                .attr("stroke", "white")
                .attr("stroke-width", 1);

            // Button handlers
            function updateView(driverFilter) {
                // Update button states
                d3.selectAll(".controls button").classed("active", false);

                if (driverFilter === 'all') {
                    d3.select("#btn-all").classed("active", true);
                    // Show all
                    paths.classed("active", true);
                    d3.selectAll(".driver-marker").classed("active", true);
                } else {
                    d3.select(`#btn-${driverFilter}`).classed("active", true);
                    // Show only selected driver
                    paths.classed("active", d => driverNames[d[0]].toLowerCase() === driverFilter);
                    d3.selectAll(".driver-marker").classed("active", false);
                    d3.selectAll(`.start-${Object.keys(driverNames).find(k => driverNames[k].toLowerCase() === driverFilter)}`)
                        .classed("active", true);
                    d3.selectAll(`.end-${Object.keys(driverNames).find(k => driverNames[k].toLowerCase() === driverFilter)}`)
                        .classed("active", true);
                }
            }

            // Event listeners
            d3.select("#btn-all").on("click", () => updateView('all'));
            d3.select("#btn-verstappen").on("click", () => updateView('verstappen'));
            d3.select("#btn-perez").on("click", () => updateView('perez'));
            d3.select("#btn-tsunoda").on("click", () => updateView('tsunoda'));

        }).catch(err => {
            console.error(err);
            d3.select("#chart").append("p").text("Error loading CSV. Make sure you ran the python script.");
        });

    </script>
</body>

</html>